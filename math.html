
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Solver - Marxes</title>
    <link href="/public/top/css_file/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/public/top/js_file/static/css/style.css">
    
<script src="/public/top/css_file/npm/tesseract.min.js"></script>

</head>
<body>
    <!-- Top bar -->
    <div class="top-bar">
    <a href="login.html" id="auth-link">Log in</a>
    <button id="logout-btn" style="display:none;" class="btn btn-link">Uitloggen</button>
</div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo-area">
            <img src="/public/top/js_file/static/images/lion-logo.svg" alt="Lion Logo">
            <div class="logo-text">Marxes</div>
        </div>

        <div class="menu">
            <a href="marxes.html">Menu</a>
            <a href="math.html">Math</a>
            <a href="physics.html">Physics</a>
            <a href="chemistry.html">Chemistry</a>
            <a href="geography.html">Geography</a>
        </div>

        <div class="search-area">
            <div class="search">
                üîç <input type="text" placeholder="Zoek" id="search-input">
            </div>
        </div>
    </nav>

    <!-- Main content -->
    <main>
        
<div class="container mt-4">
    <div class="math-solver">
        <h2>üî¢ AI Math Solver</h2>
        <p class="text-muted">Solve math problems by typing them or uploading a photo</p>
        
        <!-- Text input section -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>üìù Type Your Problem</h5>
            </div>
            <div class="card-body">
                <textarea id="textInput" class="form-control mb-3" rows="3" placeholder="Type your math problem here... (e.g., 2x + 5 = 15)"></textarea>
                <button onclick="solveTextMath()" class="btn btn-primary">
                    <span class="btn-text">Solve Problem</span>
                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                </button>
            </div>
        </div>
        
        <!-- Image upload section -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>üì∑ Upload Problem Image</h5>
            </div>
            <div class="card-body">
                <input type="file" accept="image/*" capture="environment" id="imageInput" class="form-control mb-3">
                <button onclick="solveImageMath()" class="btn btn-success">
                    <span class="btn-text">Solve from Image</span>
                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                </button>
            </div>
        </div>
        
        <!-- Results section -->
        <div class="card">
            <div class="card-header">
                <h5>üéØ Solutions</h5>
            </div>
            <div class="card-body">
                <div id="output" class="solution-output">
                    Ready to solve your math problems! Choose an input method above.
                </div>
            </div>
        </div>
        
        <!-- Training status -->
        <div class="card mt-4">
            <div class="card-header">
                <h5>üìä Training Status</h5>
            </div>
            <div class="card-body">
                <div id="training-status">Loading training status...</div>
                <button onclick="refreshTrainingStatus()" class="btn btn-outline-info btn-sm mt-2">Refresh Status</button>
            </div>
        </div>
    </div>
</div>

    </main>

    <!-- Scripts -->
    <script src="/public/top/css_file/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/public/top/js_file/static/js/main.js"></script>
    
<script>
// Global variables
let isProcessing = false;

// Load training status on page load
document.addEventListener('DOMContentLoaded', function() {
    refreshTrainingStatus();
});

function setButtonLoading(buttonId, loading) {
    const button = document.querySelector(`#${buttonId} button`) || document.querySelector('button[onclick*="' + buttonId + '"]');
    if (button) {
        const spinner = button.querySelector('.spinner-border');
        const text = button.querySelector('.btn-text');
        
        if (loading) {
            spinner.classList.remove('d-none');
            button.disabled = true;
            if (text) text.textContent = 'Processing...';
        } else {
            spinner.classList.add('d-none');
            button.disabled = false;
            if (text) text.textContent = button.onclick.includes('Text') ? 'Solve Problem' : 'Solve from Image';
        }
    }
}

async function solveTextMath() {
    if (isProcessing) return;
    
    const input = document.getElementById('textInput').value.trim();
    const output = document.getElementById('output');
    
    if (!input) {
        alert("Please enter a math problem!");
        return;
    }
    
    isProcessing = true;
    output.innerHTML = '<div class="alert alert-info">üîÑ Solving your problem...</div>';
    
    try {
        const response = await fetch("/solve-math", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ problem: input })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            displaySolutions(data);
        } else {
            output.innerHTML = `<div class="alert alert-danger">‚ùå Error: ${data.error || 'Unknown error occurred'}</div>`;
        }
    } catch (err) {
        console.error('Error:', err);
        output.innerHTML = '<div class="alert alert-danger">‚ùå Network error. Please check your connection.</div>';
    } finally {
        isProcessing = false;
    }
}

async function solveImageMath() {
    if (isProcessing) return;
    
    const fileInput = document.getElementById('imageInput');
    const output = document.getElementById('output');
    
    if (!fileInput.files[0]) {
        alert("Please select or take a photo!");
        return;
    }
    
    isProcessing = true;
    output.innerHTML = '<div class="alert alert-info">üì∑ Extracting text from image...</div>';
    
    try {
        // OCR Processing
        const { data: { text } } = await Tesseract.recognize(fileInput.files[0], 'eng', {
            logger: m => {
                if (m.status === 'recognizing text') {
                    output.innerHTML = `<div class="alert alert-info">üì∑ Processing image... ${Math.round(m.progress * 100)}%</div>`;
                }
            }
        });
        
        if (!text.trim()) {
            output.innerHTML = '<div class="alert alert-warning">‚ö†Ô∏è Could not extract text from image. Try a clearer photo.</div>';
            return;
        }
        
        output.innerHTML = `<div class="alert alert-success">üì∑ Extracted problem: <strong>${text.trim()}</strong></div><div class="alert alert-info">üîÑ Solving problem...</div>`;
        
        // Solve the extracted problem
        const response = await fetch("/solve-math", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ problem: text.trim() })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            displaySolutions(data);
        } else {
            output.innerHTML = `<div class="alert alert-danger">‚ùå Error: ${data.error || 'Unknown error occurred'}</div>`;
        }
        
    } catch (err) {
        console.error('Error:', err);
        output.innerHTML = '<div class="alert alert-danger">‚ùå Error processing image or solving problem.</div>';
    } finally {
        isProcessing = false;
    }
}

function displaySolutions(data) {
    const output = document.getElementById('output');
    
    let html = `
        <div class="problem-display mb-4">
            <h5>üìù Problem:</h5>
            <div class="alert alert-light">${data.problem}</div>
        </div>
        <div class="solutions-display">
            <h5>üéØ AI Solutions:</h5>
    `;
    
    // Gemini Solution
    html += `
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">
                <h6 class="mb-0">üîµ AI Math Solution</h6>
            </div>
            <div class="card-body">
                <div class="solution-text" style="font-family: Arial, sans-serif;">${data.solutions.gemini}</div>
            </div>
        </div>
    `;
    
    html += '</div>';
    output.innerHTML = html;
    
    // Refresh training status after successful solve
    setTimeout(refreshTrainingStatus, 1000);
}

async function refreshTrainingStatus() {
    const statusDiv = document.getElementById('training-status');
    
    try {
        statusDiv.innerHTML = 'üîÑ Loading...';
        const response = await fetch('/training-status');
        const data = await response.json();
        
        if (response.ok) {
            statusDiv.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <strong>Total Problems:</strong> ${data.total_problems}
                    </div>
                    <div class="col-md-6">
                        <strong>Last Updated:</strong> ${data.last_updated ? new Date(data.last_updated).toLocaleString() : 'Never'}
                    </div>
                </div>
                <div class="mt-2">
                    <small class="text-muted">Training data is automatically collected from successful problem solutions.</small>
                </div>
            `;
        } else {
            statusDiv.innerHTML = '<div class="text-danger">‚ùå Error loading training status</div>';
        }
    } catch (err) {
        console.error('Error loading training status:', err);
        statusDiv.innerHTML = '<div class="text-danger">‚ùå Network error loading status</div>';
    }
}
</script>

</body>
</html>